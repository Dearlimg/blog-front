# Blog Microservices

## é¡¹ç›®æ¶æ„

è¿™æ˜¯ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„åšå®¢ç³»ç»Ÿï¼Œä½¿ç”¨Kafkaä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—è¿›è¡ŒæœåŠ¡é—´é€šä¿¡ã€‚

### å¾®æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway   â”‚    â”‚   User Service  â”‚    â”‚  Wallet Service â”‚
â”‚     (8000)      â”‚    â”‚     (8001)      â”‚    â”‚     (8002)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Comment Service â”‚
                    â”‚     (8003)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Kafka Message   â”‚
                    â”‚     Queue       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     MySQL       â”‚    â”‚      Redis      â”‚    â”‚   Zookeeper     â”‚
â”‚     (3307)      â”‚    â”‚     (6379)      â”‚    â”‚     (2181)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡è¯´æ˜

1. **APIç½‘å…³ (8000)**ï¼šç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±è¯·æ±‚åˆ°å„ä¸ªå¾®æœåŠ¡
2. **ç”¨æˆ·æœåŠ¡ (8001)**ï¼šå¤„ç†ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€é‚®ç®±éªŒè¯
3. **é’±åŒ…æœåŠ¡ (8002)**ï¼šå¤„ç†æ”¯ä»˜ã€è½¬è´¦ã€ä½™é¢ç®¡ç†
4. **è¯„è®ºæœåŠ¡ (8003)**ï¼šå¤„ç†è¯„è®ºçš„CRUDæ“ä½œ

### æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.23.0
- **Webæ¡†æ¶**: Gin
- **æ•°æ®åº“**: MySQL 8.0 + GORM
- **ç¼“å­˜**: Redis 7
- **æ¶ˆæ¯é˜Ÿåˆ—**: Apache Kafka
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **é‚®ä»¶æœåŠ¡**: QQé‚®ç®±SMTP

### åŠŸèƒ½ç‰¹æ€§

#### ç”¨æˆ·æœåŠ¡
- âœ… ç”¨æˆ·æ³¨å†Œï¼ˆæ”¯æŒQQé‚®ç®±ï¼‰
- âœ… ç”¨æˆ·ç™»å½•
- âœ… é‚®ç®±éªŒè¯ç éªŒè¯
- âœ… å¯†ç åŠ å¯†å­˜å‚¨
- âœ… Kafkaäº‹ä»¶å‘å¸ƒ

#### é’±åŒ…æœåŠ¡
- âœ… é’±åŒ…åˆ›å»ºå’Œç®¡ç†
- âœ… ä½™é¢å¢åŠ /æ‰£é™¤
- âœ… äº¤æ˜“è®°å½•
- âœ… ç”¨æˆ·é—´è½¬è´¦
- âœ… æ”¯ä»˜äº‹ä»¶é€šçŸ¥

#### è¯„è®ºæœåŠ¡
- âœ… è¯„è®ºåˆ›å»ºå’ŒæŸ¥è¯¢
- âœ… è¯„è®ºæ›´æ–°å’Œåˆ é™¤
- âœ… æ”¯æŒå›å¤åŠŸèƒ½
- âœ… è½¯åˆ é™¤æœºåˆ¶
- âœ… è¯„è®ºäº‹ä»¶å‘å¸ƒ

#### APIç½‘å…³
- âœ… è¯·æ±‚è·¯ç”±å’Œä»£ç†
- âœ… CORSè·¨åŸŸæ”¯æŒ
- âœ… è®¤è¯ä¸­é—´ä»¶
- âœ… å¥åº·æ£€æŸ¥
- âœ… æœåŠ¡å‘ç°

### å¿«é€Ÿå¼€å§‹

#### 1. ç¯å¢ƒè¦æ±‚
- Docker & Docker Compose
- Go 1.23+ (æœ¬åœ°å¼€å‘)

#### 2. å¯åŠ¨æœåŠ¡
```bash
# ä½¿ç”¨Docker Composeå¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-microservices.sh

# æˆ–è€…æ‰‹åŠ¨å¯åŠ¨
docker-compose up --build -d
```

#### 3. æµ‹è¯•API
```bash
# è¿è¡ŒAPIæµ‹è¯•
./test-microservices.sh
```

#### 4. æœåŠ¡è®¿é—®
- APIç½‘å…³: http://localhost:8000
- ç”¨æˆ·æœåŠ¡: http://localhost:8001
- é’±åŒ…æœåŠ¡: http://localhost:8002
- è¯„è®ºæœåŠ¡: http://localhost:8003

### APIæ¥å£

#### ç”¨æˆ·æœåŠ¡
```bash
# ç”¨æˆ·æ³¨å†Œ
POST /api/v1/users/register
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123"
}

# ç”¨æˆ·ç™»å½•
POST /api/v1/users/login
{
  "email": "test@example.com",
  "password": "password123"
}

# é‚®ç®±éªŒè¯
POST /api/v1/users/verify-email
{
  "email": "test@example.com",
  "code": "123456"
}
```

#### é’±åŒ…æœåŠ¡
```bash
# åˆ›å»ºé’±åŒ…
POST /api/v1/wallets/{user_id}

# å¢åŠ ä½™é¢
POST /api/v1/wallets/{user_id}/add
{
  "amount": 100.0,
  "description": "å……å€¼"
}

# æ‰£é™¤ä½™é¢
POST /api/v1/wallets/{user_id}/deduct
{
  "amount": 50.0,
  "description": "æ¶ˆè´¹"
}

# è½¬è´¦
POST /api/v1/wallets/transfer
{
  "from_user_id": 1,
  "to_user_id": 2,
  "amount": 25.0,
  "description": "è½¬è´¦"
}
```

#### è¯„è®ºæœåŠ¡
```bash
# åˆ›å»ºè¯„è®º
POST /api/v1/comments
{
  "user_id": 1,
  "content": "è¿™æ˜¯ä¸€æ¡è¯„è®º",
  "parent_id": null
}

# è·å–è¯„è®º
GET /api/v1/comments

# æ›´æ–°è¯„è®º
PUT /api/v1/comments/{id}
{
  "content": "æ›´æ–°åçš„è¯„è®ºå†…å®¹"
}

# åˆ é™¤è¯„è®º
DELETE /api/v1/comments/{id}
```

### é…ç½®è¯´æ˜

#### æ•°æ®åº“é…ç½®
- MySQL: `root:sta_go@tcp(47.118.19.28:3307)/blog`
- Redis: `47.118.19.28:6379` (å¯†ç : `sta_go`)

#### é‚®ä»¶é…ç½®
- SMTPæœåŠ¡å™¨: smtp.qq.com:465
- é‚®ç®±: 1492568061@qq.com
- å¯†ç : nbafgutnzsediibc

#### Kafkaé…ç½®
- Broker: 47.118.19.28:9092
- Topics:
  - `user.register` - ç”¨æˆ·æ³¨å†Œäº‹ä»¶
  - `user.login` - ç”¨æˆ·ç™»å½•äº‹ä»¶
  - `user.email.verify` - é‚®ç®±éªŒè¯äº‹ä»¶
  - `wallet.payment` - æ”¯ä»˜äº‹ä»¶
  - `comment.create` - è¯„è®ºåˆ›å»ºäº‹ä»¶
  - `comment.update` - è¯„è®ºæ›´æ–°äº‹ä»¶
  - `comment.delete` - è¯„è®ºåˆ é™¤äº‹ä»¶

### å¼€å‘æŒ‡å—

#### æœ¬åœ°å¼€å‘
```bash
# å¯åŠ¨åŸºç¡€è®¾æ–½æœåŠ¡
docker-compose up mysql redis kafka zookeeper -d

# å¯åŠ¨å•ä¸ªæœåŠ¡
cd services/user-service
go run main.go
```

#### æ·»åŠ æ–°æœåŠ¡
1. åœ¨ `services/` ç›®å½•ä¸‹åˆ›å»ºæ–°æœåŠ¡
2. å®ç°æ ‡å‡†çš„æœåŠ¡ç»“æ„ï¼ˆconfig, repository, logic, controllerï¼‰
3. åœ¨ `docker-compose.yml` ä¸­æ·»åŠ æœåŠ¡é…ç½®
4. åœ¨APIç½‘å…³ä¸­æ·»åŠ è·¯ç”±é…ç½®

### ç›‘æ§å’Œæ—¥å¿—

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f [service_name]

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs -f
```

### éƒ¨ç½²è¯´æ˜

ç³»ç»Ÿæ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥é€šè¿‡Docker Composeä¸€é”®å¯åŠ¨ã€‚

### ğŸ“ é¡¹ç›®ç»“æ„

```
Blog-v1.0.0/
â”œâ”€â”€ services/                    # å¾®æœåŠ¡ç›®å½•
â”‚   â”œâ”€â”€ api-gateway/            # APIç½‘å…³æœåŠ¡ (8000ç«¯å£)
â”‚   â”‚   â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ controller/         # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ Dockerfile         # Dockeré•œåƒæ„å»º
â”‚   â”‚   â””â”€â”€ main.go            # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ user-service/           # ç”¨æˆ·æœåŠ¡ (8001ç«¯å£)
â”‚   â”‚   â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ controller/         # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ logic/              # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ repository/         # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ Dockerfile         # Dockeré•œåƒæ„å»º
â”‚   â”‚   â””â”€â”€ main.go            # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ wallet-service/         # é’±åŒ…æœåŠ¡ (8002ç«¯å£)
â”‚   â”‚   â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ controller/         # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ logic/              # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ repository/         # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ Dockerfile         # Dockeré•œåƒæ„å»º
â”‚   â”‚   â””â”€â”€ main.go            # æœåŠ¡å…¥å£
â”‚   â””â”€â”€ comment-service/        # è¯„è®ºæœåŠ¡ (8003ç«¯å£)
â”‚       â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ controller/         # æ§åˆ¶å™¨å±‚
â”‚       â”œâ”€â”€ logic/              # ä¸šåŠ¡é€»è¾‘å±‚
â”‚       â”œâ”€â”€ repository/         # æ•°æ®è®¿é—®å±‚
â”‚       â”œâ”€â”€ Dockerfile         # Dockeré•œåƒæ„å»º
â”‚       â””â”€â”€ main.go            # æœåŠ¡å…¥å£
â”œâ”€â”€ shared/                     # å…±äº«æ¨¡å—
â”‚   â”œâ”€â”€ kafka/                 # Kafkaæ¶ˆæ¯é˜Ÿåˆ—
â”‚   â”œâ”€â”€ email/                 # é‚®ä»¶æœåŠ¡
â”‚   â””â”€â”€ models/                # å…±äº«æ•°æ®æ¨¡å‹
â”œâ”€â”€ docker-compose.yml         # Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ go.mod                     # Goæ¨¡å—ä¾èµ–
â”œâ”€â”€ go.sum                     # Goä¾èµ–æ ¡éªŒ
â”œâ”€â”€ README.md                  # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ start-microservices.sh     # å¯åŠ¨è„šæœ¬
â””â”€â”€ test-microservices.sh      # æµ‹è¯•è„šæœ¬
```

### ğŸ¯ å¾®æœåŠ¡æ¶æ„ä¼˜åŠ¿

1. **æœåŠ¡ç‹¬ç«‹**: æ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²å’Œæ‰©å±•
2. **æŠ€æœ¯æ ˆçµæ´»**: ä¸åŒæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆ
3. **æ•…éšœéš”ç¦»**: å•ä¸ªæœåŠ¡çš„æ•…éšœä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿ
4. **å›¢é˜Ÿåä½œ**: ä¸åŒå›¢é˜Ÿå¯ä»¥ç‹¬ç«‹è´Ÿè´£ä¸åŒçš„æœåŠ¡
5. **æ°´å¹³æ‰©å±•**: å¯ä»¥æ ¹æ®éœ€è¦ç‹¬ç«‹æ‰©å±•ç‰¹å®šæœåŠ¡

### ğŸ“š æ›´å¤šæ–‡æ¡£

- [é¡¹ç›®ç»“æ„è¯´æ˜](PROJECT_STRUCTURE.md) - è¯¦ç»†çš„ç›®å½•ç»“æ„
- [Nginx+Redisæ¶æ„](nginx-redis-architecture.md) - ä½¿ç”¨Nginxä½œä¸ºåå‘ä»£ç†çš„æ¶æ„è¯´æ˜

### ğŸ”§ éƒ¨ç½²æ–¹å¼

#### æ–¹å¼1ï¼šDocker Composeï¼ˆæ¨èï¼‰
```bash
./start-microservices.sh
```

#### æ–¹å¼2ï¼šNginx + Redisï¼ˆæœ¬åœ°å¼€å‘ï¼‰
```bash
./start-with-nginx.sh
```

www.durlim.xyz